export type Language = "no" | "en";

const LANGUAGE_KEY = "stjernejakt_language";

export const loadLanguage = (): Language => {
  try {
    const stored = localStorage.getItem(LANGUAGE_KEY);
    if (stored === "en" || stored === "no") {
      return stored;
    }
  } catch (error) {
    console.error("Error loading language:", error);
  }
  return "no";
};

export const saveLanguage = (language: Language): void => {
  try {
    localStorage.setItem(LANGUAGE_KEY, language);
  } catch (error) {
    console.error("Error saving language:", error);
  }
};

export const translations = {
  no: {
    // Home
    appTitle: "Stjernejobb",
    whoIsReady: "Hvem er klar for oppdrag?",
    addChild: "Legg til barn",
    begin: "G√• til oppdrag",
    points: "poeng",
    parentMode: "üîí Foreldremodus",
    addNewChild: "Legg til nytt barn",
    name: "Navn",
    namePlaceholder: "F.eks. Emma",
    selectAvatar: "Velg avatar",
    add: "‚ûï Legg til",
    welcome: "‚≠ê Velkommen til Stjernejobb ‚≠ê",
    welcomeMessage1: "Legg til barn",
    welcomeMessage2: "Inne p√• foreldremodus kan du legge til oppgaver og bel√∏nninger.",
    ok: "OK",

    // Tasks
    tasks: "Oppdrag",
    back: "‚Üê Tilbake",
    shop: "Butikk",
    done: "Ferdig!",
    completed: "‚úÖ",
    taskCompleted: "Bra jobba! Du fikk {points} poeng! ‚≠ê",
    welcomeTitle: "Velkommen til Stjernejobb!",
    welcomeMessage:
      "Her er noen standard oppgaver. Inne p√• foreldremodus kan du legge til egne oppgaver og bel√∏nninger :)",
    
    // Shop
    myPoints: "Se mine poeng",
    buy: "Kj√∏p",
    alreadyPurchased: "Du har allerede kj√∏pt denne!",
    congratulations: "Gratulerer! Du kj√∏pte {name}! üéâ",
    needMorePoints: "Du trenger {points} poeng til! üòä",
    
    // Parent Mode
    enterPin: "Skriv inn PIN-kode",
    pinCode: "PIN-kode",
    unlock: "L√•s opp",
    cancel: "Avbryt",
    defaultPin: "Standard PIN: 1234",
    defaultPinHint: "Du kan endre PIN inne i foreldremodus",
    welcomeParent: "Velkommen, forelder!",
    wrongPin: "Feil PIN-kode",
    addNewTask: "Legg til ny oppgave",
    taskName: "Oppgavenavn",
    taskNamePlaceholder: "F.eks. Rydd rommet",
    selectIcon: "Velg ikon",
    clickToSelectEmoji: "Trykk for √• velge emoji",
    pointValue: "Poengverdi",
    addTask: "‚ûï Legg til oppgave",
    existingTasks: "Eksisterende oppgaver",
    noTasksYet: "Ingen oppgaver enn√•",
    applyToChildren: "Kopier til flere barn",
    reset: "üîÑ Tilbakestill",
    delete: "Slett",
    addNewReward: "Legg til ny bel√∏nning",
    rewardName: "Bel√∏nningsnavn",
    rewardNamePlaceholder: "F.eks. Iskrem",
    price: "Pris (poeng)",
    addReward: "‚ûï Legg til bel√∏nning",
    manageRewards: "Administrer bel√∏nninger",
    noRewardsYet: "Ingen bel√∏nninger enn√•",
    manageChildren: "Slett profiler",
    selectChildToManage: "Velg barn √• administrere",
    deduct: "‚ûñ Trekk fra",
    addPoints: "‚ûï Legg til",
    actions: "Handlinger",
    resetAllTasks: "üîÑ Tilbakestill alle oppgaver",
    resetAllRewards: "üîÑ Tilbakestill alle bel√∏nninger",
    changePin: "üîê Endre PIN-kode",
    newPin: "Ny PIN (4 siffer)",
    confirmPin: "Bekreft PIN",
    updatePin: "Oppdater PIN",
    resetData: "üóëÔ∏è Tilbakestill data",
    resetDataConfirm: "Tilbakestille all data?",
    resetDataWarning:
      "Dette sletter alle oppgaver, bel√∏nninger, barn og poeng. Dette kan ikke angres.",
    yesReset: "Ja, tilbakestill",
    tips: "Tips",
    tip1: "‚Ä¢ Hver profil har n√• egne oppgaver og bel√∏nninger",
    tip2: "‚Ä¢ Velg et barn √∏verst for √• administrere dets oppgaver og bel√∏nninger",
    tip3: "‚Ä¢ Sp√∏r barna om hvilke oppgaver de √∏nsker √• gj√∏re og bel√∏nninger de kan kj√∏pe i butikken",
    language: "Spr√•k",
    norwegian: "Norsk",
    english: "English",
    adminOverview: "Adminoversikt",
    childrenCount: "{count} barn",
    tasksCount: "{count} oppgaver",
    rewardsCount: "{count} bel√∏nninger",
    syncAcrossDevices: "Del data mellom enheter",
    syncTapToOpen: "√Öpne deling for √• synkronisere",
    syncOpen: "√Öpne deling",
    generalSettings: "Generelt",
    childSettings: "Barn",
    noChildrenYet: "Ingen barn lagt til enn√•",
    addChildFromHome: "Legg til barn p√• hjemskjermen f√∏rst",
    goToParentMode: "G√• til foreldremodus",
    selectChildToShop: "Velg et barn for √• handle",
    selectChildToShopHint: "Velg barn p√• hjemskjermen f√∏r du √•pner butikken",
    goToHome: "G√• til hjem",
    tasksForChild: "Oppgaver for {name}",
    rewardsForChild: "Bel√∏nninger for {name}",
    pointsForChild: "Poeng for {name}",
    activityLog: "Aktivitetslogg for {name}",
    existingRewards: "Eksisterende bel√∏nninger",
    viewAllTasks: "Vis alle oppgaver ({count})",
    viewAllRewards: "Vis alle bel√∏nninger ({count})",
    allTasksTitle: "Alle oppgaver for {name}",
    allRewardsTitle: "Alle bel√∏nninger for {name}",
    close: "Lukk",
    purchaseSettings: "Kj√∏psinnstillinger",
    trialPhaseLimit:
      "Takk for at du bruker Stjernejobb! Vi er i pr√∏vefasen og vil senere legge til en premium versjon der du kan ha evig med oppgaver, bel√∏nninger og andre morsomme ting. For n√• er det maks 3 oppgaver og 3 bel√∏nninger per barn.",
    requirePinForPurchase: "Krev PIN ved kj√∏p",
    pinRequiredForShop: "Barn m√• oppgi PIN for √• kj√∏pe i butikken",
    enable24hReset: "10t reset for oppgaver/bel√∏nninger",
    enable24hResetDescription: "Sl√• av for dette barnet for √• kunne gj√∏re oppgaver/bel√∏nninger p√• nytt med en gang",
      timeLockHint: "Skru av tidsl√•s inne p√• barnets profil.",
    on: "P√Ö",
    off: "AV",
    
    // Toasts
    childAdded: "{name} er lagt til! üéâ",
    fillAllFields: "Vennligst fyll ut alle felt",
    fillAllFieldsCorrectly: "Vennligst fyll ut alle felt riktig",
    taskAdded: "Ny oppgave er lagt til!",
    taskDeleted: "Oppgave slettet",
    taskReset: "Oppgave tilbakestilt!",
    rewardAdded: "Ny bel√∏nning er lagt til!",
    rewardDeleted: "Bel√∏nning slettet",
    rewardReset: "Bel√∏nning tilbakestilt!",
    rewardPurchasedMessage: "Bel√∏nning kj√∏pt!",
    childRemoved: "Barn fjernet",
    bonusTaskMessage: "Fullf√∏r 3 oppgaver innen 24t og f√• 5 poeng ekstra!",
    bonusProgress: "{count}/{total} mot bonus",
    confirmDeleteTitle: "Slett {name}?",
    confirmDeleteDescription:
      "Er du sikker p√• at du vil slette dette barnet? Alle oppgaver og bel√∏nninger vil ogs√• bli slettet.",
    confirmDeleteTask: "Slett oppgave?",
    confirmDeleteTaskDescription: "Er du sikker p√• at du vil slette denne oppgaven? Dette kan ikke angres.",
    confirmDeleteReward: "Slett bel√∏nning?",
    confirmDeleteRewardDescription:
      "Er du sikker p√• at du vil slette denne bel√∏nningen? Dette kan ikke angres.",
    confirmYes: "Ja",
    confirmNo: "Nei",
    manageChild: "Administrer {name}",
    deleteChild: "Slett barn",
    deleteChildWarning: "Dette fjerner barnet og alle oppgaver/bel√∏nninger.",
    mustHaveOneChild: "Du m√• ha minst ett barn!",
    allTasksReset: "Alle oppgaver er tilbakestilt!",
    allRewardsReset: "Alle bel√∏nninger er tilbakestilt!",
    pinMustBe4Digits: "PIN m√• v√¶re 4 siffer",
    pinsDoNotMatch: "PIN-kodene stemmer ikke overens",
    pinUpdated: "PIN-kode oppdatert!",
    dataReset: "Data tilbakestilt!",
    pointsDeducted: "Trakk fra {points} poeng fra {name}",
    pointsAdded: "La til {points} poeng til {name}",
    cannotDeductMore: "Kan ikke trekke mer enn barnet har!",
    enterValidPoints: "Skriv inn et gyldig antall poeng",
    
    // Validation
    nameCannotBeEmpty: "Navn kan ikke v√¶re tomt",
    nameTooLong: "Navn m√• v√¶re mindre enn 30 tegn",
    selectAvatarRequired: "Velg en avatar",
    taskNameCannotBeEmpty: "Oppgavenavn kan ikke v√¶re tomt",
    taskNameTooLong: "Navn m√• v√¶re mindre enn 50 tegn",
    selectIconRequired: "Velg et ikon",
    pointsMin: "Poeng m√• v√¶re minst 1",
    pointsMax: "Poeng m√• v√¶re maks 100",
    rewardNameCannotBeEmpty: "Bel√∏nningsnavn kan ikke v√¶re tomt",
    rewardNameTooLong: "Navn m√• v√¶re mindre enn 50 tegn",
    priceMin: "Pris m√• v√¶re minst 1 poeng",
    priceMax: "Pris m√• v√¶re maks 1000 poeng",

    // Sync/QR
    syncDevices: "Del data mellom enheter",
    syncDescription: "Del data manuelt mellom enheter. Dette er ikke automatisk synkronisering.",
    exportImport: "Eksporter/importer",
    selectMethodBelow: "Velg metode under",
    showQRCode: "Vis QR-kode",
    scanQRCode: "Skann QR-kode",
    shareViaEmail: "Del via e-post",
    shareViaSMS: "Del via SMS",
    showAsText: "Vis som tekst",
    copyText: "Kopier tekst",
    stopScanning: "Stopp skanning",
    scanToSync: "Skann koden eller lim inn data for √• oppdatere den andre enheten",
    dataSizeLabel: "Datamengde: {size} KB",
    qrTooLarge: "QR-kode fungerer best for sm√• datamengder. Bruk tekst eller e-post.",
    importData: "Importer data",
    importDataDescription: "Lim inn data du har mottatt fra en annen enhet",
    pasteDataHere: "Lim inn data her...",
    importButton: "Importer",
    importantToKnow: "Viktig √• vite",
    syncWarning:
      "Dette er en engangsoverf√∏ring. Gjenta n√•r du vil oppdatere mellom enheter.",
    noInternet: "Ingen internett",
    sameDataEverywhere: "Samme data overalt",
    qrCodeGenerated: "QR-kode generert! Skann med andre enheten.",
    copyTextToShare: "Kopier teksten og send til andre enheten.",
    copiedToClipboard: "Kopiert! Send til andre enheten.",
    shareDataSubject: "Stjernejakt - App Data",
    shareDataBody: "Her er dataene fra Stjernejakt-appen:",
    openingEmailApp: "√Öpner e-post app...",
    openingSMSApp: "√Öpner SMS app...",
    dataImported: "Data importert! ‚úÖ",
    invalidData: "Ugyldig data - sjekk at du har limt inn riktig tekst",
    cameraPermissionDenied:
      "Kamera-tillatelse avsl√•tt. √Öpne innstillinger og tillat kamera-tilgang.",
    cameraError: "Kunne ikke starte kamera. Sjekk tillatelser eller pr√∏v tekstmetoden.",
    invalidQRCode: "Ugyldig QR-kode",
    tooMuchData: "For mye data ({size} KB). Slett noen barn/oppgaver.",
    smsNotAvailable: "SMS ikke tilgjengelig for store datamengder. Bruk e-post eller tekst.",
  },
  en: {
    // Home
    appTitle: "Stjernejobb",
    whoIsReady: "Who's ready for tasks?",
    addChild: "Add child",
    begin: "Go to tasks",
    points: "points",
    parentMode: "üîí Parent Mode",
    addNewChild: "Add new child",
    name: "Name",
    namePlaceholder: "E.g. Emma",
    selectAvatar: "Select avatar",
    add: "‚ûï Add",
    welcome: "‚≠ê Welcome to Stjernejobb ‚≠ê",
    welcomeMessage1: "Add a child",
    welcomeMessage2: "In parent mode you can add tasks and rewards.",
    ok: "OK",
    
    // Tasks
    tasks: "Missions",
    back: "‚Üê Back",
    shop: "Shop",
    done: "Done!",
    completed: "‚úÖ",
    taskCompleted: "Great job! You earned {points} points! ‚≠ê",
    welcomeTitle: "Welcome to Stjernejobb!",
    welcomeMessage:
      "Here are some standard tasks. In parent mode you can add your own tasks and rewards :)",
    
    // Shop
    myPoints: "See my points",
    buy: "Buy",
    alreadyPurchased: "You already bought this!",
    congratulations: "Congratulations! You bought {name}! üéâ",
    needMorePoints: "You need {points} more points! üòä",
    
    // Parent Mode
    enterPin: "Enter PIN code",
    pinCode: "PIN code",
    unlock: "Unlock",
    cancel: "Cancel",
    defaultPin: "Default PIN: 1234",
    defaultPinHint: "You can change the PIN inside parent mode",
    welcomeParent: "Welcome, parent!",
    wrongPin: "Wrong PIN code",
    addNewTask: "Add new task",
    taskName: "Task name",
    taskNamePlaceholder: "E.g. Clean room",
    selectIcon: "Select icon",
    clickToSelectEmoji: "Click to select emoji",
    pointValue: "Point value",
    addTask: "‚ûï Add task",
    existingTasks: "Existing tasks",
    noTasksYet: "No tasks yet",
    applyToChildren: "Copy to multiple children",
    reset: "üîÑ Reset",
    delete: "Delete",
    addNewReward: "Add new reward",
    rewardName: "Reward name",
    rewardNamePlaceholder: "E.g. Ice cream",
    price: "Price (points)",
    addReward: "‚ûï Add reward",
    manageRewards: "Manage rewards",
    noRewardsYet: "No rewards yet",
    manageChildren: "Delete profiles",
    selectChildToManage: "Select child to manage",
    deduct: "‚ûñ Deduct",
    addPoints: "‚ûï Add",
    actions: "Actions",
    resetAllTasks: "üîÑ Reset all tasks",
    resetAllRewards: "üîÑ Reset all rewards",
    changePin: "üîê Change PIN code",
    newPin: "New PIN (4 digits)",
    confirmPin: "Confirm PIN",
    updatePin: "Update PIN",
    resetData: "üóëÔ∏è Reset data",
    resetDataConfirm: "Reset all data?",
    resetDataWarning:
      "This will delete all tasks, rewards, children and points. This cannot be undone.",
    yesReset: "Yes, reset",
    tips: "Tips",
    tip1: "‚Ä¢ Each profile now has its own tasks and rewards",
    tip2: "‚Ä¢ Select a child at the top to manage their tasks and rewards",
    tip3: "‚Ä¢ Ask the children which tasks they want to do and rewards they can buy in the shop",
    language: "Language",
    norwegian: "Norsk",
    english: "English",
    adminOverview: "Admin overview",
    childrenCount: "{count} children",
    tasksCount: "{count} tasks",
    rewardsCount: "{count} rewards",
    syncAcrossDevices: "Share data between devices",
    syncTapToOpen: "Open sharing to sync",
    syncOpen: "Open sharing",
    generalSettings: "General",
    childSettings: "Child settings",
    noChildrenYet: "No children added yet",
    addChildFromHome: "Add a child from the home screen first",
    goToParentMode: "Go to parent mode",
    selectChildToShop: "Select a child to shop",
    selectChildToShopHint: "Select a child on the home screen before opening the shop",
    goToHome: "Go to home",
    tasksForChild: "Tasks for {name}",
    rewardsForChild: "Rewards for {name}",
    pointsForChild: "Points for {name}",
    activityLog: "Activity log for {name}",
    existingRewards: "Existing rewards",
    viewAllTasks: "View all tasks ({count})",
    viewAllRewards: "View all rewards ({count})",
    allTasksTitle: "All tasks for {name}",
    allRewardsTitle: "All rewards for {name}",
    close: "Close",
    purchaseSettings: "Purchase settings",
    requirePinForPurchase: "Require PIN for purchase",
    pinRequiredForShop: "Children must enter PIN to buy in the shop",
    enable24hReset: "10h reset for tasks/rewards",
    enable24hResetDescription: "Turn off for this child to redo tasks/rewards immediately",
      timeLockHint: "Turn off time lock in the child profile.",
    on: "ON",
    off: "OFF",
    
    // Toasts
    childAdded: "{name} has been added! üéâ",
    fillAllFields: "Please fill in all fields",
    fillAllFieldsCorrectly: "Please fill in all fields correctly",
    taskAdded: "New task has been added!",
    taskDeleted: "Task deleted",
    taskReset: "Task reset!",
    rewardAdded: "New reward has been added!",
    rewardDeleted: "Reward deleted",
    rewardReset: "Reward reset!",
    rewardPurchasedMessage: "Reward purchased!",
    trialPhaseLimit:
      "Thank you for using Stjernejobb! We are in the trial phase and will later add a premium version where you can have unlimited tasks, rewards and other fun things. For now, there is a maximum of 3 tasks and 3 rewards per child.",
    childRemoved: "Child removed",
    bonusTaskMessage: "Complete 3 tasks within 24h and get 5 bonus points!",
    bonusProgress: "{count}/{total} toward bonus",
    confirmDeleteTitle: "Delete {name}?",
    confirmDeleteDescription:
      "Are you sure you want to delete this child? All tasks and rewards will also be deleted.",
    confirmDeleteTask: "Delete task?",
    confirmDeleteTaskDescription: "Are you sure you want to delete this task? This cannot be undone.",
    confirmDeleteReward: "Delete reward?",
    confirmDeleteRewardDescription:
      "Are you sure you want to delete this reward? This cannot be undone.",
    confirmYes: "Yes",
    confirmNo: "No",
    manageChild: "Manage {name}",
    deleteChild: "Delete child",
    deleteChildWarning: "This removes the child and all tasks/rewards.",
    mustHaveOneChild: "You must have at least one child!",
    allTasksReset: "All tasks have been reset!",
    allRewardsReset: "All rewards have been reset!",
    pinMustBe4Digits: "PIN must be 4 digits",
    pinsDoNotMatch: "PIN codes do not match",
    pinUpdated: "PIN code updated!",
    dataReset: "Data reset!",
    pointsDeducted: "Deducted {points} points from {name}",
    pointsAdded: "Added {points} points to {name}",
    cannotDeductMore: "Cannot deduct more than the child has!",
    enterValidPoints: "Enter a valid number of points",
    
    // Validation
    nameCannotBeEmpty: "Name cannot be empty",
    nameTooLong: "Name must be less than 30 characters",
    selectAvatarRequired: "Select an avatar",
    taskNameCannotBeEmpty: "Task name cannot be empty",
    taskNameTooLong: "Name must be less than 50 characters",
    selectIconRequired: "Select an icon",
    pointsMin: "Points must be at least 1",
    pointsMax: "Points must be at most 100",
    rewardNameCannotBeEmpty: "Reward name cannot be empty",
    rewardNameTooLong: "Name must be less than 50 characters",
    priceMin: "Price must be at least 1 point",
    priceMax: "Price must be at most 1000 points",

    // Sync/QR
    syncDevices: "Share data between devices",
    syncDescription: "Share data manually between devices. This is not automatic sync.",
    exportImport: "Export/import",
    selectMethodBelow: "Select method below",
    showQRCode: "Show QR code",
    scanQRCode: "Scan QR code",
    shareViaEmail: "Share via email",
    shareViaSMS: "Share via SMS",
    showAsText: "Show as text",
    copyText: "Copy text",
    stopScanning: "Stop scanning",
    scanToSync: "Scan the code or paste data to update the other device",
    dataSizeLabel: "Data size: {size} KB",
    qrTooLarge: "QR works best for small data. Use text or email instead.",
    importData: "Import data",
    importDataDescription: "Paste data you received from another device",
    pasteDataHere: "Paste data here...",
    importButton: "Import",
    importantToKnow: "Important to know",
    syncWarning:
      "This is a one-time transfer. Repeat whenever you want to update between devices.",
    noInternet: "No internet",
    sameDataEverywhere: "Same data everywhere",
    qrCodeGenerated: "QR code generated! Scan with other device.",
    copyTextToShare: "Copy the text and send to other device.",
    copiedToClipboard: "Copied! Send to other device.",
    shareDataSubject: "Stjernejobb - App Data",
    shareDataBody: "Here is the data from the Stjernejobb app:",
    openingEmailApp: "Opening email app...",
    openingSMSApp: "Opening SMS app...",
    dataImported: "Data imported! ‚úÖ",
    invalidData: "Invalid data - check that you pasted the correct text",
    cameraPermissionDenied:
      "Camera permission denied. Open settings and allow camera access.",
    cameraError: "Could not start camera. Check permissions or try the text method.",
    invalidQRCode: "Invalid QR code",
    tooMuchData: "Too much data ({size} KB). Delete some children/tasks.",
    smsNotAvailable: "SMS not available for large data. Use email or text instead.",
  },
} as const;

export const translate = (
  lang: Language,
  key: keyof typeof translations.no,
  params?: Record<string, string | number>
): string => {
  let text: string | undefined = translations[lang][key];
  if (typeof text !== "string") {
    return key as string;
  }
  if (params) {
    Object.entries(params).forEach(([param, value]) => {
      text = text.replace(`{${param}}`, String(value));
    });
  }
  return text;
};