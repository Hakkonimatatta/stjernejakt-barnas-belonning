export type Language = "no" | "en";

const LANGUAGE_KEY = "stjernejakt_language";

export const loadLanguage = (): Language => {
  try {
    const stored = localStorage.getItem(LANGUAGE_KEY);
    if (stored === "en" || stored === "no") {
      return stored;
    }
  } catch (error) {
    console.error("Error loading language:", error);
  }
  return "no";
};

export const saveLanguage = (language: Language): void => {
  try {
    localStorage.setItem(LANGUAGE_KEY, language);
  } catch (error) {
    console.error("Error saving language:", error);
  }
};

export const translations = {
  no: {
    // Home
    appTitle: "Stjernejobb",
    whoIsReady: "Hvem er klar for oppdrag?",
    addChild: "Legg til barn",
    begin: "Begynn",
    points: "poeng",
    parentMode: "üîí Foreldremodus",
    addNewChild: "Legg til nytt barn",
    name: "Navn",
    namePlaceholder: "F.eks. Emma",
    selectAvatar: "Velg avatar",
    add: "‚ûï Legg til",
    welcome: "‚≠ê Velkommen til Stjernejobb ‚≠ê",
    welcomeMessage1: "Legg til profil",
    welcomeMessage2: "Inne p√• foreldremodus kan du legge til oppgaver og bel√∏nninger.",
    ok: "OK",
    
    // Tasks
    tasks: "Oppdrag",
    back: "‚Üê Tilbake",
    shop: "Butikk",
    done: "Ferdig!",
    completed: "‚úÖ",
    taskCompleted: "Bra jobba! Du fikk {points} poeng! ‚≠ê",
    
    // Shop
    myPoints: "Se mine poeng",
    buy: "Kj√∏p",
    alreadyPurchased: "Du har allerede kj√∏pt denne!",
    congratulations: "Gratulerer! Du kj√∏pte {name}! üéâ",
    needMorePoints: "Du trenger {points} poeng til! üòä",
    
    // Parent Mode
    enterPin: "Skriv inn PIN-kode",
    pinCode: "PIN-kode",
    unlock: "L√•s opp",
    cancel: "Avbryt",
    defaultPin: "Standard PIN: 1234 (kan endres inne i foreldremodus)",
    welcomeParent: "Velkommen, forelder!",
    wrongPin: "Feil PIN-kode",
    addNewTask: "Legg til ny oppgave",
    taskName: "Oppgavenavn",
    taskNamePlaceholder: "F.eks. Rydd rommet",
    selectIcon: "Velg ikon",
    clickToSelectEmoji: "Trykk for √• velge emoji",
    pointValue: "Poengverdi",
    addTask: "‚ûï Legg til oppgave",
    existingTasks: "Eksisterende oppgaver",
    noTasksYet: "Ingen oppgaver enn√•",
    reset: "üîÑ Tilbakestill",
    delete: "Slett",
    addNewReward: "Legg til ny bel√∏nning",
    rewardName: "Bel√∏nningsnavn",
    rewardNamePlaceholder: "F.eks. Iskrem",
    price: "Pris (poeng)",
    addReward: "‚ûï Legg til bel√∏nning",
    manageRewards: "Administrer bel√∏nninger",
    noRewardsYet: "Ingen bel√∏nninger enn√•",
    manageChildren: "Administrer barn",
    selectChildToManage: "Velg barn √• administrere",
    deduct: "‚ûñ Trekk fra",
    addPoints: "‚ûï Legg til",
    actions: "Handlinger",
    resetAllTasks: "üîÑ Tilbakestill alle oppgaver",
    resetAllRewards: "üîÑ Tilbakestill alle bel√∏nninger",
    changePin: "üîê Endre PIN-kode",
    newPin: "Ny PIN (4 siffer)",
    confirmPin: "Bekreft PIN",
    updatePin: "Oppdater PIN",
    resetData: "üóëÔ∏è Tilbakestill data",
    resetDataConfirm: "Tilbakestille all data?",
    resetDataWarning: "Dette sletter alle oppgaver, bel√∏nninger, barn og poeng. Dette kan ikke angres.",
    yesReset: "Ja, tilbakestill",
    tips: "Tips",
    tip1: "‚Ä¢ Oppgaver og bel√∏nninger tilbakestilles automatisk etter 2 sekunder",
    tip2: "‚Ä¢ Du kan endre PIN-koden n√•r som helst",
    tip3: "‚Ä¢ Sp√∏r barna om hvilke oppgaver de √∏nsker √• gj√∏re og bel√∏nninger de kan kj√∏pe i butikken",
    language: "Spr√•k",
    norwegian: "Norsk",
    english: "English",
    adminOverview: "Adminoversikt",
    childrenCount: "{count} barn",
    tasksCount: "{count} oppgaver",
    rewardsCount: "{count} bel√∏nninger",
    syncAcrossDevices: "Samkj√∏re p√• flere enheter?",
    syncTapToOpen: "Trykk her for √• synkronisere med andre enheter",
    tasksForChild: "Oppgaver for {name}",
    rewardsForChild: "Bel√∏nninger for {name}",
    pointsForChild: "Poeng for {name}",
    existingRewards: "Eksisterende bel√∏nninger",
    
    // Toasts
    childAdded: "{name} er lagt til! üéâ",
    fillAllFields: "Vennligst fyll ut alle felt",
    fillAllFieldsCorrectly: "Vennligst fyll ut alle felt riktig",
    taskAdded: "Ny oppgave er lagt til!",
    taskDeleted: "Oppgave slettet",
    taskReset: "Oppgave tilbakestilt!",
    rewardAdded: "Ny bel√∏nning er lagt til!",
    rewardDeleted: "Bel√∏nning slettet",
    rewardReset: "Bel√∏nning tilbakestilt!",
    childRemoved: "Barn fjernet",
    mustHaveOneChild: "Du m√• ha minst ett barn!",
    allTasksReset: "Alle oppgaver er tilbakestilt!",
    allRewardsReset: "Alle bel√∏nninger er tilbakestilt!",
    pinMustBe4Digits: "PIN m√• v√¶re 4 siffer",
    pinsDoNotMatch: "PIN-kodene stemmer ikke overens",
    pinUpdated: "PIN-kode oppdatert!",
    dataReset: "Data tilbakestilt!",
    pointsDeducted: "Trakk fra {points} poeng fra {name}",
    pointsAdded: "La til {points} poeng til {name}",
    cannotDeductMore: "Kan ikke trekke mer enn barnet har!",
    enterValidPoints: "Skriv inn et gyldig antall poeng",
    
    // Validation
    nameCannotBeEmpty: "Navn kan ikke v√¶re tomt",
    nameTooLong: "Navn m√• v√¶re mindre enn 30 tegn",
    selectAvatarRequired: "Velg en avatar",
    taskNameCannotBeEmpty: "Oppgavenavn kan ikke v√¶re tomt",
    taskNameTooLong: "Navn m√• v√¶re mindre enn 50 tegn",
    selectIconRequired: "Velg et ikon",
    pointsMin: "Poeng m√• v√¶re minst 1",
    pointsMax: "Poeng m√• v√¶re mindre enn 100",
    rewardNameCannotBeEmpty: "Bel√∏nningsnavn kan ikke v√¶re tomt",
    rewardNameTooLong: "Navn m√• v√¶re mindre enn 50 tegn",
    priceMin: "Pris m√• v√¶re minst 1 poeng",
    priceMax: "Pris m√• v√¶re mindre enn 1000 poeng",

    // Sync/QR
    syncDevices: "Samkj√∏r flere enheter",
    syncDescription: "Del data med hverandre for √• synkronisere mellom enheter",
    exportImport: "Eksporter/importer",
    selectMethodBelow: "Velg metode under",
    showQRCode: "Vis QR-kode",
    scanQRCode: "Skann QR-kode",
    shareViaEmail: "Del via e-post",
    shareViaSMS: "Del via SMS",
    showAsText: "Vis som tekst",
    copyText: "Kopier tekst",
    stopScanning: "Stopp skanning",
    scanToSync: "Skann koden med en annen enhet for √• synkronisere",
    importData: "Importer data",
    importDataDescription: "Lim inn data du har mottatt fra en annen enhet",
    pasteDataHere: "Lim inn data her...",
    importButton: "Importer",
    importantToKnow: "Viktig √• vite",
    syncWarning: "Synkroniseringen m√• gj√∏res gjentatte ganger. Data blir kun hentet fra √∏yeblikket koden skannes.",
    noInternet: "Ingen internett",
    sameDataEverywhere: "Samme data overalt",
    qrCodeGenerated: "QR-kode generert! Skann med andre enheten.",
    copyTextToShare: "Kopier teksten og send til andre enheten.",
    copiedToClipboard: "Kopiert! Send til andre enheten.",
    shareDataSubject: "Stjernejakt - App Data",
    shareDataBody: "Her er dataene fra Stjernejakt-appen:",
    openingEmailApp: "√Öpner e-post app...",
    openingSMSApp: "√Öpner SMS app...",
    dataImported: "Data importert! ‚úÖ",
    invalidData: "Ugyldig data - sjekk at du har limt inn riktig tekst",
    cameraPermissionDenied: "Kamera-tillatelse avsl√•tt. √Öpne innstillinger og tillat kamera-tilgang.",
    cameraError: "Kunne ikke starte kamera. Sjekk tillatelser eller pr√∏v tekstmetoden.",
    invalidQRCode: "Ugyldig QR-kode",
    tooMuchData: "For mye data ({size} KB). Slett noen barn/oppgaver.",
    smsNotAvailable: "SMS ikke tilgjengelig for store datamengder. Bruk e-post eller QR-kode.",
  },
  en: {
    // Home
    appTitle: "Stjernejobb",
    whoIsReady: "Who's ready for tasks?",
    addChild: "Add child",
    begin: "Begin",
    points: "points",
    parentMode: "üîí Parent Mode",
    addNewChild: "Add new child",
    name: "Name",
    namePlaceholder: "E.g. Emma",
    selectAvatar: "Select avatar",
    add: "‚ûï Add",
    welcome: "‚≠ê Welcome to Stjernejobb ‚≠ê",
    welcomeMessage1: "Add a profile",
    welcomeMessage2: "In parent mode you can add tasks and rewards.",
    ok: "OK",
    
    // Tasks
    tasks: "Missions",
    back: "‚Üê Back",
    shop: "Shop",
    done: "Done!",
    completed: "‚úÖ",
    taskCompleted: "Great job! You earned {points} points! ‚≠ê",
    
    // Shop
    myPoints: "See my points",
    buy: "Buy",
    alreadyPurchased: "You already bought this!",
    congratulations: "Congratulations! You bought {name}! üéâ",
    needMorePoints: "You need {points} more points! üòä",
    
    // Parent Mode
    enterPin: "Enter PIN code",
    pinCode: "PIN code",
    unlock: "Unlock",
    cancel: "Cancel",
    defaultPin: "Default PIN: 1234 (can be changed in parent mode)",
    welcomeParent: "Welcome, parent!",
    wrongPin: "Wrong PIN code",
    addNewTask: "Add new task",
    taskName: "Task name",
    taskNamePlaceholder: "E.g. Clean room",
    selectIcon: "Select icon",
    clickToSelectEmoji: "Click to select emoji",
    pointValue: "Point value",
    addTask: "‚ûï Add task",
    existingTasks: "Existing tasks",
    noTasksYet: "No tasks yet",
    reset: "üîÑ Reset",
    delete: "Delete",
    addNewReward: "Add new reward",
    rewardName: "Reward name",
    rewardNamePlaceholder: "E.g. Ice cream",
    price: "Price (points)",
    addReward: "‚ûï Add reward",
    manageRewards: "Manage rewards",
    noRewardsYet: "No rewards yet",
    manageChildren: "Manage children",
    selectChildToManage: "Select child to manage",
    deduct: "‚ûñ Deduct",
    addPoints: "‚ûï Add",
    actions: "Actions",
    resetAllTasks: "üîÑ Reset all tasks",
    resetAllRewards: "üîÑ Reset all rewards",
    changePin: "üîê Change PIN code",
    newPin: "New PIN (4 digits)",
    confirmPin: "Confirm PIN",
    updatePin: "Update PIN",
    resetData: "üóëÔ∏è Reset data",
    resetDataConfirm: "Reset all data?",
    resetDataWarning: "This will delete all tasks, rewards, children and points. This cannot be undone.",
    yesReset: "Yes, reset",
    tips: "Tips",
    tip1: "‚Ä¢ Tasks and rewards automatically reset after 2 seconds",
    tip2: "‚Ä¢ You can change the PIN code at any time",
    tip3: "‚Ä¢ Ask the children which tasks they want to do and rewards they can buy in the shop",
    language: "Language",
    norwegian: "Norsk",
    english: "English",
    adminOverview: "Admin overview",
    childrenCount: "{count} children",
    tasksCount: "{count} tasks",
    rewardsCount: "{count} rewards",
    syncAcrossDevices: "Sync across devices?",
    syncTapToOpen: "Tap here to sync with other devices",
    tasksForChild: "Tasks for {name}",
    rewardsForChild: "Rewards for {name}",
    pointsForChild: "Points for {name}",
    existingRewards: "Existing rewards",
    
    // Toasts
    childAdded: "{name} has been added! üéâ",
    fillAllFields: "Please fill in all fields",
    fillAllFieldsCorrectly: "Please fill in all fields correctly",
    taskAdded: "New task has been added!",
    taskDeleted: "Task deleted",
    taskReset: "Task reset!",
    rewardAdded: "New reward has been added!",
    rewardDeleted: "Reward deleted",
    rewardReset: "Reward reset!",
    childRemoved: "Child removed",
    mustHaveOneChild: "You must have at least one child!",
    allTasksReset: "All tasks have been reset!",
    allRewardsReset: "All rewards have been reset!",
    pinMustBe4Digits: "PIN must be 4 digits",
    pinsDoNotMatch: "PIN codes do not match",
    pinUpdated: "PIN code updated!",
    dataReset: "Data reset!",
    pointsDeducted: "Deducted {points} points from {name}",
    pointsAdded: "Added {points} points to {name}",
    cannotDeductMore: "Cannot deduct more than the child has!",
    enterValidPoints: "Enter a valid number of points",
    
    // Validation
    nameCannotBeEmpty: "Name cannot be empty",
    nameTooLong: "Name must be less than 30 characters",
    selectAvatarRequired: "Select an avatar",
    taskNameCannotBeEmpty: "Task name cannot be empty",
    taskNameTooLong: "Name must be less than 50 characters",
    selectIconRequired: "Select an icon",
    pointsMin: "Points must be at least 1",
    pointsMax: "Points must be less than 100",
    rewardNameCannotBeEmpty: "Reward name cannot be empty",
    rewardNameTooLong: "Name must be less than 50 characters",
    priceMin: "Price must be at least 1 point",
    priceMax: "Price must be less than 1000 points",

    // Sync/QR
    syncDevices: "Sync Multiple Devices",
    syncDescription: "Share data with each other to synchronize between devices",
    exportImport: "Export/import",
    selectMethodBelow: "Select method below",
    showQRCode: "Show QR code",
    scanQRCode: "Scan QR code",
    shareViaEmail: "Share via email",
    shareViaSMS: "Share via SMS",
    showAsText: "Show as text",
    copyText: "Copy text",
    stopScanning: "Stop scanning",
    scanToSync: "Scan the code with another device to synchronize",
    importData: "Import data",
    importDataDescription: "Paste data you received from another device",
    pasteDataHere: "Paste data here...",
    importButton: "Import",
    importantToKnow: "Important to know",
    syncWarning: "Synchronization must be done repeatedly. Data is only fetched from the moment the code is scanned.",
    noInternet: "No internet",
    sameDataEverywhere: "Same data everywhere",
    qrCodeGenerated: "QR code generated! Scan with other device.",
    copyTextToShare: "Copy the text and send to other device.",
    copiedToClipboard: "Copied! Send to other device.",
    shareDataSubject: "Stjernejobb - App Data",
    shareDataBody: "Here is the data from the Stjernejobb app:",
    openingEmailApp: "Opening email app...",
    openingSMSApp: "Opening SMS app...",
    dataImported: "Data imported! ‚úÖ",
    invalidData: "Invalid data - check that you pasted the correct text",
    cameraPermissionDenied: "Camera permission denied. Open settings and allow camera access.",
    cameraError: "Could not start camera. Check permissions or try the text method.",
    invalidQRCode: "Invalid QR code",
    tooMuchData: "Too much data ({size} KB). Delete some children/tasks.",
    smsNotAvailable: "SMS not available for large amounts of data. Use email or QR code.",
  },
} as const;

export const translate = (
  lang: Language,
  key: keyof typeof translations.no,
  params?: Record<string, string | number>
): string => {
  let text: string = translations[lang][key];
  
  if (params) {
    Object.entries(params).forEach(([param, value]) => {
      text = text.replace(`{${param}}`, String(value));
    });
  }
  
  return text;
};
